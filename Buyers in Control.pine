// Buyers in Control



//@version=6
indicator("Buyers in Control", shorttitle="BIC", overlay=true, max_labels_count=100)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INPUTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Price momentum settings
emaLengthInput = input.int(21, "EMA Length", minval=1, group="Price Momentum")

// Volume confirmation settings
volumeMultipleInput = input.float(1.2, "Volume Multiple (vs SMA)", minval=0.5, step=0.1, group="Volume Confirmation")
volumeAvgLengthInput = input.int(20, "Volume SMA Length", minval=1, group="Volume Confirmation")

// RSI momentum settings
rsiLengthInput = input.int(14, "RSI Length", minval=1, group="RSI Momentum")
rsiThresholdInput = input.int(50, "RSI Threshold", minval=0, maxval=100, group="RSI Momentum")

// Visual settings
showBackgroundInput = input.bool(true, "Show Background", group="Display")
showLabelsInput = input.bool(true, "Show Labels", group="Display")
showEMAInput = input.bool(true, "Show EMA Reference", group="Display")
buyerColorInput = input.color(color.new(color.green, 90), "Buyer Control BG Color", group="Display")
emaColorInput = input.color(color.blue, "EMA Color", group="Display")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALCULATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

//@variable Exponential moving average for trend detection
emaValue = ta.ema(close, emaLengthInput)

//@variable Simple moving average of volume
volumeSMA = ta.sma(volume, volumeAvgLengthInput)

//@variable Relative Strength Index for momentum
rsiValue = ta.rsi(close, rsiLengthInput)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUYER CONTROL CONDITIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

//@variable True when price is above the EMA (bullish trend)
// bool priceAboveEMA = close > emaValue

//@variable True when volume exceeds the average (strong participation)
// bool volumeConfirmed = volume > volumeSMA * volumeMultipleInput

//@variable True when RSI shows positive momentum
// bool momentumPositive = rsiValue > rsiThresholdInput

//@variable True when all buyer control conditions are met
// bool buyersInControl = priceAboveEMA and volumeConfirmed and momentumPositive

//@variable True when buyers just took control (transition from false to true)
// bool buyerTakeover = buyersInControl and not buyersInControl[1]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VISUALIZATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Background color when buyers are in control (MUST be at global scope)
bgcolor(showBackgroundInput and buyersInControl ? buyerColorInput : na, title="Buyers in Control BG")

// Label on chart when buyers take control
if showLabelsInput and buyerTakeover
//     label.new(
//       bar_index, 
//       high, 
//       "ðŸŸ¢ BUYERS", 
      style=label.style_label_down, 
      color=color.green, 
      textcolor=color.white, 
      size=size.small,
      tooltip="Price > EMA, Volume elevated, RSI bullish"
//      )

// Plot EMA reference line
plot(showEMAInput ? emaValue : na, "EMA Reference", emaColorInput, 2)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Alert when buyers take control
// alertcondition(
//   buyerTakeover, 
  title="Buyers Take Control", 
  message="ðŸŸ¢ Buyers are now in control!\nPrice: {{close}}\nRSI: {{plot_0}}\nVolume: {{volume}}"
//  )

// Alert when buyers lose control
// alertcondition(
//   not buyersInControl and buyersInControl[1], 
  title="Buyers Lose Control", 
  message="âš ï¸ Buyers lost control\nPrice: {{close}}"
//  )

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABLE DASHBOARD (Optional - shows current status)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var table dashboard = table.new(position.top_right, 2, 5, bgcolor=color.new(color.black, 80), border_width=1)

if barstate.islast
    // Header
//     table.cell(dashboard, 0, 0, "Condition", text_color=color.white, bgcolor=color.new(color.gray, 50))
//     table.cell(dashboard, 1, 0, "Status", text_color=color.white, bgcolor=color.new(color.gray, 50))
    
    // Price condition
//     table.cell(dashboard, 0, 1, "Price > EMA", text_color=color.white)
//     table.cell(dashboard, 1, 1, priceAboveEMA ? "âœ“" : "âœ—", 
      text_color=priceAboveEMA ? color.green : color.red, 
      bgcolor=priceAboveEMA ? color.new(color.green, 80) : color.new(color.red, 80))
    
    // Volume condition
//     table.cell(dashboard, 0, 2, "Volume OK", text_color=color.white)
//     table.cell(dashboard, 1, 2, volumeConfirmed ? "âœ“" : "âœ—", 
      text_color=volumeConfirmed ? color.green : color.red,
      bgcolor=volumeConfirmed ? color.new(color.green, 80) : color.new(color.red, 80))
    
    // RSI condition
//     table.cell(dashboard, 0, 3, "RSI > " + str.tostring(rsiThresholdInput), text_color=color.white)
//     table.cell(dashboard, 1, 3, momentumPositive ? "âœ“" : "âœ—", 
      text_color=momentumPositive ? color.green : color.red,
      bgcolor=momentumPositive ? color.new(color.green, 80) : color.new(color.red, 80))
    
    // Overall status
//     table.cell(dashboard, 0, 4, "BUYERS", text_color=color.white, bgcolor=color.new(color.blue, 50))
//     table.cell(dashboard, 1, 4, buyersInControl ? "IN CONTROL" : "NOT IN CONTROL", 
      text_color=color.white,
      bgcolor=buyersInControl ? color.new(color.green, 30) : color.new(color.red, 30))
